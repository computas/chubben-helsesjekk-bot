"use strict";exports.id=806,exports.ids=[806],exports.modules={36806:(e,t,a)=>{a.d(t,{Q:()=>eD,v:()=>e$});var n,i=a(93430),o=a(20957),r=a(33104),s=a(70612);async function l(){let e=s.hostname(),t=process.env.ELECTOR_PATH;if(!t)throw Error("Missing env var ELECTOR_PATH, are you sure you enabled leader election in nais.yml?");console.info(`Checking if pod (${e}) is leader on ${t}`);let a=await fetch(`http://${t}`,{cache:"no-store"});if(!a.ok)throw Error(`Failed to fetch leader from ${t}, response: ${a.status} ${a.statusText}`);let n=await a.json();return console.info(`Is this pod (${e}) leader? Leader election says: ${JSON.stringify(n)}`),n.name===e}var c=a(16279),u=a(68206),d=a(56081),p=a(17569),k=a(46231),m=a(38595),h=a(86480),v=a(25535),w=a(18767),y=a(4654),g=a(3377),f=a(56187),_=a(75003),b=a(53310),x=a(80163),$=a(18196),D=a(64253),E=a(26251);function T({team:e,frequency:t,weekSkew:a}){let n=(0,p.JT)(),i=(0,p.uW)(n);if(1===t)return(0,h.w)(n)>e.postDay+1?{postDate:j(i+1,e.postDay+1,e.postHour)(n),isThisWeekRelevant:!1}:(0,v.p)(n)>e.postHour?{postDate:j(i,e.postDay+1,e.postHour)(n),isThisWeekRelevant:!0}:{postDate:H(e.postDay+1,e.postHour)(n),isThisWeekRelevant:!0};let o=q(n,t,a),r=o.find(e=>e>=i),s=r?j(r,e.postDay+1,e.postHour)(n):null;if(i+t>(0,w.u)(n)&&(null==r||!(0,y.J)(s)||s&&(0,g.R)(n,s))){let i=q(A((0,f.S)(n)+1,1,e.postDay+1,e.postHour)(n),t,a)[0];return{postDate:A((0,f.S)(n)+1,i,e.postDay+1,e.postHour)(n),isThisWeekRelevant:!1}}return s&&(0,g.R)(n,s)?{postDate:j(o.find(e=>e>i)??(0,E.O)(Error("Unable to find upcoming week")),e.postDay+1,e.postHour)(n),isThisWeekRelevant:!1}:{postDate:s??(0,E.O)(Error("Illegal state: Date can't be null at this point")),isThisWeekRelevant:r===i}}!function(e){e[e.WEEKLY=1]="WEEKLY",e[e.BIWEEKLY=2]="BIWEEKLY",e[e.TRIWEEKLY=3]="TRIWEEKLY",e[e.FOURWEEKLY=4]="FOURWEEKLY"}(n||(n={}));let j=(e,t,a)=>k.a((0,_.u)({weekStartsOn:1,locale:D.nb})(e),(0,b.f)({weekStartsOn:1,locale:D.nb})(t),(0,x.B)(a)),A=(e,t,a,n)=>k.a((0,$.M)(e),j(t,a,n)),H=(e,t)=>k.a((0,x.B)(t),(0,b.f)({weekStartsOn:1})(e));function S(e){let t=(0,p.dJ)(e),a=(0,p.jQ)(e);return 0===a?"denne timen, eller har allerede blitt lagt ut":a<24?`om ${a} timer`:0===t?"i dag":`om ${t+1} dager`}function q(e,t,a){let[n]=[m.a(1,(0,w.u)(e)+1),m.a(1,5)];return n.filter(e=>(e+a)%t==0)}var L=a(96279),Q=a(46005),I=a(67166),M=a(83562),R=a(61121),F=a(39152);function O(e){return{type:"header",text:{text:e,type:"plain_text"}}}function U(e){return{type:"section",text:{type:"mrkdwn",text:e}}}function W(e,t){if(e){let e=t();return Array.isArray(e)?e:[e]}return[]}function C(e,t){if(null!=e&&e.length>0){let a=t(e);return Array.isArray(a)?a:[a]}return[]}var K=a(43194),N=a(76014);let P={FillButtonClicked:"open_health_check_modal-action"};function B(e,t,a=!1){return[{type:"header",text:{type:"plain_text",text:`:health: Det er p\xe5 tide med helsesjekk uke ${(0,p.uW)(t)} for ${e}! :wave:`,emoji:!0}},{type:"section",text:{type:"mrkdwn",text:"Alle p\xe5 dette teamet inviteres til \xe5 svare p\xe5 noen raske sp\xf8rsm\xe5l for \xe5 dele hvordan de f\xf8ler tilstanden p\xe5 teamet er. Svarene gis p\xe5 trafikklys-format.\n\n\uD83D\uDFE2 Bra! \n\uD83D\uDFE1 Middels \n\uD83D\uDD34 D\xe5rlig "}},a?U("Denne helsesjekken hadde ikke nok svar, s\xe5 resultatet vil ikke bli delt."):{type:"actions",elements:[{action_id:P.FillButtonClicked,type:"button",text:{type:"plain_text",text:"Svar p\xe5 helsesjekk"},style:"primary",value:"click_me_123"}]},{type:"context",elements:[{type:"mrkdwn",text:"Hva du svarer deles ikke med noen. Det brukes kun til \xe5 lage helsemetrikker for teamet."}]}]}function G(e,t,a){return{type:"context",elements:[{type:"mrkdwn",text:0===e?"Ingen har svart enda. Det er p\xe5 tide \xe5 svare!":`${e} har svart p\xe5 helsesjekken! Metrikkene vil bli delt kl. ${t}:00 p\xe5 ${(0,p.hR)(a)}.`}]}}function J(e,t){if(null==t)return"";let a=e-t;return`(${a>0?"+":""}${a.toFixed(1)})`}async function Y(e,t){let a=await t.chat.postMessage({channel:e.id,text:`Hvordan har ${e.name} det?`,blocks:[...B(e.name,new Date),G(0,e.revealHour,e.revealDay)]});return a.ok&&null!=a.ts?(await (0,d.createAsked)(a.ts,e.id,(0,L.Pg)(e.questions)),!0):(console.error(`Unable to post message for team ${e.name}, error: ${a.error??"Unknown error"}`),!1)}async function V(e,t){let a=await (0,d.getActiveAsk)(e.id);if(null==a)return console.error("Weird state: Found no active asked when trying nag team"),!1;let n=await t.chat.postMessage({channel:e.id,thread_ts:a.messageTs,text:`:mega: N\xe5 er det kun en time til helsesjekken stenges! :mega:

Det er forel\xf8pig ${a.answers.length} som har svart.`,reply_broadcast:!0});return n.ok&&null!=n.ts?(await (0,d.markAskedAsNagged)(a.id),!0):(console.error(`Unable to post message for team ${e.name}, error: ${n.error??"Unknown error"}`),!1)}async function z(e,t){let a=await (0,d.getActiveAsk)(e.id);if(null==a)return!1;let n=await t.chat.update({channel:e.id,ts:a.messageTs,text:`Hvordan har ${e.name} det?`,blocks:[...B(e.name,a.timestamp),G(a.answers.length,e.revealHour,e.revealDay)]});return!!n.ok||(console.error(`Unable to update message for team ${e.name}, error: ${n.error??"Unknown error"}`),!1)}async function X(e,t){var a,n;let i=await (0,d.getActiveAsk)(e.id);if(null==i)return console.error("Weird state: Found no active asked when trying to reveal"),!1;if(i.answers.length<3)return await t.chat.postMessage({channel:e.id,thread_ts:i.messageTs,text:`Det er kun ${i.answers.length} svar p\xe5 helsesjekken. Det kreves minimum 3 svar for at resultatene skal deles.`,reply_broadcast:!0}),await t.chat.update({channel:e.id,ts:i.messageTs,text:`Ukentlig helsesjekk for team ${e.name} er n\xe5 avsluttet.`,blocks:[...B(e.name,i.timestamp,!0),G(i.answers.length,e.revealHour,e.revealDay)]}),await (0,d.markAskedRevealed)(i.id,!0),!1;let o=await t.chat.update({channel:e.id,ts:i.messageTs,text:`Ukentlig helsesjekk for team ${e.name} er n\xe5 avsluttet.`,blocks:(a=i.answers.length,n=i.timestamp,[{type:"header",text:{type:"plain_text",text:`:health: Takk for at du svarte p\xe5 helsesjekken for uke ${(0,p.uW)(n)}! Denne er n\xe5 stengt. :lock:`,emoji:!0}},{type:"section",text:{type:"mrkdwn",text:`Det var ${a} svar p\xe5 denne ukens helsesjekk.`}}])}),r=await (0,d.getPreviousAsk)(i),s=(0,Q.q)(i),l=r?(0,Q.q)(r):null;return await t.chat.postMessage({channel:e.id,thread_ts:o.ts,text:`Svar p\xe5 ukentlig helsesjekk for ${e.name}`,blocks:function(e,t,a,n){let i=a.scoredQuestions.some(e=>e.optional)?"\n _* = antall svar p\xe5 valgfritt sp\xf8rsm\xe5l_":"";return[O(`Helsesjekkresultat for team ${e.name} i uke ${(0,p.uW)(t.timestamp)}`),{type:"section",text:{type:"mrkdwn",text:function(e,t){let a=I.a(e.scoredQuestions,M.a(R.a("type")),F.a()),n=e=>{let a=e.optional?` _(${e.answerCount}*)_`:"";return 0===e.score?`:warning: *${e.question}*${a}: _Ikke nok svar_`:`${(0,N.S)(e.score)} *${e.question}*${a}: ${e.score.toFixed(1)} ${function(e,t){if(null==t)return"";let a=t.scoredQuestions.find(t=>t.id===e.id);return null==a||0===a.score?"":J(e.score,a.score)}(e,t)}`};return`${a.map(([e,t])=>`*${(0,K.L)(e)}*:
${t.map(n).join("\n")}`).join("\n")}`}(a,n)}},{type:"section",text:{type:"mrkdwn",text:`
*Total score for ${e.name} i uke ${(0,p.uW)(t.timestamp)}*: ${(0,N.S)(a.totalScore)} ${a.totalScore.toFixed(1)} ${J(a.totalScore,n?.totalScore??null)}${i}`}},{type:"context",elements:[{type:"plain_text",text:`Det var ${t.answers.length} svar p\xe5 denne ukens helsesjekk.`}]}]}(e,i,s,l),reply_broadcast:!0}),await (0,d.markAskedRevealed)(i.id),!0}async function Z(e){let t=await (0,d.getActiveTeams)(),a=t.filter(e=>{let{isThisWeekRelevant:t}=T({team:e,frequency:e.frequency,weekSkew:e.weekSkew});return t}),n=(0,p.JT)(),i=(0,p.i1)(n),o=(0,c.p)(n),r=(0,u.q)(n);en.info(`Ask: Current time is ${i} ${o}:${r}

There are ${t.length} active teams:
${t.map(e=>`Post: ${(0,p.hR)(e.postDay)} ${e.postHour}:00,	 reveal: ${(0,p.hR)(e.revealDay)} ${e.revealHour}:00	 (${e.frequency}+${e.weekSkew})	 ${e.name}`).join("\n")}

${a.length} of them want to post this week`);let s=0;for(let t of a)if(ea(t.postDay,t.postHour)&&!await (0,d.hasActiveAsk)(t.id)&&!await (0,d.hasAskedToday)(t.id)){en.info(`It's time to post helsesjekk for team ${t.name}!`);try{await Y(t,e.client),s++}catch(e){if(e instanceof Error&&e.message.includes("An API error occurred: is_archived")){en.info(`The team ${t.name} has been archived, marking team as inactive`),await (0,d.deactivateTeam)(t.id);continue}throw Error(`Failed to post helsesjekk for team ${t.name}.`,{cause:e})}}return s}async function ee(e){let t=await (0,d.getTeamsToReveal)(),a=(0,p.JT)(),n=(0,p.i1)(a),i=(0,c.p)(a),o=(0,u.q)(a);0===t.length?en.info(`Reveal: Current time is ${n} ${i}:${o}

There are no teams to reveal this week based on active asks.`):en.info(`Reveal: Current time is ${n} ${i}:${o}

There are ${t.length} teams that need reveal this week:
${t.map(e=>`${e.name} want to reveal at ${e.revealHour}:00 on ${(0,p.hR)(e.revealDay)}`).join("\n")}`);let r=0,s=0;for(let a of t){if(ea(a.revealDay,a.revealHour-1)&&await (0,d.hasActiveUnnaggedAsk)(a.id)){en.info(`Nagging team ${a.name} about helsesjekk closing in an hour!!`);try{await V(a,e.client),s++}catch(e){if(e instanceof Error&&e.message.includes("An API error occurred: is_archived")){en.info(`The team ${a.name} has been archived, marking team as inactive`),await (0,d.deactivateTeam)(a.id);continue}en.error(Error(`Failed to remind team ${a.name} to post helsesjekk.`,{cause:e}));continue}}if(ea(a.revealDay,a.revealHour)&&await (0,d.hasActiveAsk)(a.id)){en.info(`It's time to reveal helsesjekk for team ${a.name}!`);try{await X(a,e.client),r++}catch(e){if(e instanceof Error&&e.message.includes("An API error occurred: is_archived")){en.info(`The team ${a.name} has been archived, marking team as inactive`),await (0,d.deactivateTeam)(a.id);continue}en.error(Error(`Failed to reveal helsesjekk for team ${a.name}.`,{cause:e}))}}}return{revealedTeams:r,naggedTeams:s}}async function et(){let e=await (0,d.getBrokenAsks)();e.length>0&&en.error(`Found ${e.length} asks: ${e.map(e=>e.id).join(", ")}`)}function ea(e,t){let a=(0,p.JT)(),n=(0,p.i1)(a),i=(0,c.p)(a);return n===e&&i>=t}let en=r.logger.child({x_context:"cron-job"},{level:void 0});async function ei(e){try{if(!await l())return en.info("Not the pod leader, skipping scheduled job"),"skipped"}catch(e){throw r.logger.error(Error("Failed to check if pod is leader",{cause:e})),e}en.info("Running scheduled job, checking for messages to post");let t={ask:null,reveal:null,inspect:null};try{await Z(e),t.ask="completed"}catch(e){t.ask=e,en.error(Error("Error occured during team ask",{cause:e}))}try{await ee(e),t.reveal="completed"}catch(e){t.reveal=e,en.error(Error("Error occured during team reveal",{cause:e}))}try{await et(),t.inspect="completed"}catch(e){t.inspect=e,en.error(Error("Scheduled job failed at dirty check",{cause:e}))}return"completed"===t.ask&&"completed"===t.reveal&&"completed"===t.inspect?(en.info("Scheduled job completed successfully"),"completed"):(en.error(Error("Scheduled job failed",{cause:t})),{partialError:t})}var eo=a(53622),er=a(40719),es=a(77069),el=a(35379);let ec={modalSubmit:"helsesjekk_form_modal-submit"};function eu(e,t){let a=e.required??!0,n=t?.find(t=>t.questionId===e.questionId),i={[d.AnswerLevel.GOOD]:ed(e.questionId,`游릭 ${e.answers.HIGH}`,d.AnswerLevel.GOOD),[d.AnswerLevel.MEDIUM]:ed(e.questionId,`游리 ${e.answers.MID}`,d.AnswerLevel.MEDIUM),[d.AnswerLevel.BAD]:ed(e.questionId,`游댮 ${e.answers.LOW}`,d.AnswerLevel.BAD)};return{type:"input",optional:!a,label:{type:"plain_text",text:`${e.question}`},element:{action_id:"radio-button-group-answer",type:"radio_buttons",initial_option:null!=n?i[n.answer]:void 0,options:[i[d.AnswerLevel.GOOD],i[d.AnswerLevel.MEDIUM],i[d.AnswerLevel.BAD],...W(!a,()=>ed(e.questionId,"Ikke relevant",null))]}}}function ed(e,t,a){return{text:{type:"plain_text",text:t,emoji:!0},value:`${e}:${a??"not-applicable"}`}}function ep(e){let[t,a]=e.split(":");return[t,a]}function ek(e){return{type:"plain_text",text:e,emoji:!0}}let em={modalSubmit:"helsesjekk_settings_modal-submit",teamName:{block:"team_name-block",action:"team_name-action"},postDay:{block:"post_day-block",action:"post_day-action"},postHour:{block:"post_hour-block",action:"post_hour-action"},revealDay:{block:"reveal_day-block",action:"reveal_day-action"},revealHour:{block:"reveal_hour-block",action:"reveal_hour-action"},active:{block:"active-block",action:"active-action"},addQuestion:{block:"add_question-block",action:"add_question-action"},skipAddQuestion:{block:"skip_question-block",action:"skip_question-action"},newQuestion:{blocks:{question:"new_question-block",answerHigh:"new_question-answer_high-block",answerMid:"new_question-answer_mid-block",answerLow:"new_question-answer_low-block",category:"new_question-category-block"},actions:{question:"new_question-action",answerHigh:"new_question-answer_high-action",answerMid:"new_question-answer_mid-action",answerLow:"new_question-answer_low-action",category:"new_question-category-action"}},deleteQuestion:{action:"delete_question-action"}};function eh(e,t=!1){let a=["Mandag","Tirsdag","Onsdag","Torsdag","Fredag","L\xf8rdag","S\xf8ndag"].map((e,t)=>({text:ek(e),value:t.toString()})),{postDate:n}=T({team:e,frequency:e.frequency,weekSkew:e.weekSkew});return{type:"modal",callback_id:em.modalSubmit,private_metadata:e.id,title:{type:"plain_text",text:"Helsesjekk"},blocks:[U(`Innstillinger for helsesjekk for team ${e.name}`),{block_id:em.teamName.block,type:"input",dispatch_action:!1,element:{action_id:em.teamName.action,type:"plain_text_input",initial_value:e.name},label:{type:"plain_text",text:"Teamnavn",emoji:!0}},function(e){let t={value:"active",text:{type:"plain_text",text:"Aktiv"}};return{block_id:em.active.block,type:"input",optional:!0,element:{action_id:em.active.action,type:"checkboxes",initial_options:e.active?[t]:void 0,options:[t]},label:{type:"plain_text",text:"Skal helsesjekken v\xe6re aktivert?"}}}(e),O("Tidspunkt"),U("Det er fint \xe5 sende helsesjekken p\xe5 fredag, gjerne etter friday wins. Helsesjekken vil l\xe5ses og vise statistikken, dette burde man ha klart f\xf8r monday commits."),U("For \xe5 endre p\xe5 frekvensen p\xe5 helsesjekken og andre innstillinger, bes\xf8k https://helsesjekk-bot.nav.no/"),O("Frekvens"),U(1===e.frequency?"Hver uke":`Hver ${e.frequency}. uke`),U(`Dersom botten er aktiv, er neste helsesjekk ${(0,p.hR)(e.postDay)} kl. ${e.postHour}:00 ${S(n)}`),{block_id:em.postDay.block,type:"input",label:{type:"plain_text",text:"Hvilken dag i uka skal helsesjekken sendes?"},element:{action_id:em.postDay.action,type:"static_select",placeholder:{type:"plain_text",text:"Select an item",emoji:!0},options:a,initial_option:a[e.postDay]}},{block_id:em.postHour.block,type:"input",label:{type:"plain_text",text:"N\xe5r skal helsesjekken sendes?"},element:{action_id:em.postHour.action,type:"timepicker",initial_time:`${e.postHour.toString().padStart(2,"0")}:00`,placeholder:{type:"plain_text",text:"Velg tid"}}},{block_id:em.revealDay.block,type:"input",label:{type:"plain_text",text:"Hvilken dag i uka skal helsesjekken v\xe6re ferdig?"},element:{action_id:em.revealDay.action,type:"static_select",placeholder:{type:"plain_text",text:"Select an item",emoji:!0},initial_option:a[e.revealDay],options:a}},{block_id:em.revealHour.block,type:"input",label:{type:"plain_text",text:"N\xe5r skal helsesjekken v\xe6re ferdig?"},element:{action_id:em.revealHour.action,type:"timepicker",initial_time:`${e.revealHour.toString().padStart(2,"0")}:00`,placeholder:{type:"plain_text",text:"Velg tid"}}},...function(e,t){let a=(0,L.Pg)(e.questions).filter(e=>e.custom);return[{type:"header",text:{type:"plain_text",text:"Egendefinerte sp\xf8rsm\xe5l",emoji:!0}},...W(a.length>0,()=>a.map(e=>({block_id:e.questionId,type:"section",text:{type:"mrkdwn",text:`*${e.question}*
游릭 ${e.answers.HIGH}
游리 ${e.answers.MID}
游댮 ${e.answers.LOW}`},accessory:{type:"button",text:ek("Slett sp\xf8rsm\xe5l"),confirm:{text:ek(`Er du sikker p\xe5 at du vil slette sp\xf8rsm\xe5let "${e.question}"`)},style:"danger",action_id:em.deleteQuestion.action}}))),...W(0===a.length&&!t,()=>({type:"context",elements:[ek("Ingen egendefinerte sp\xf8rsm\xe5l")]})),...W(t,()=>[{block_id:em.newQuestion.blocks.question,type:"input",element:{type:"plain_text_input",action_id:em.newQuestion.actions.question,placeholder:ek("F.eks: Kodekvalitet")},label:ek("Sp\xf8rsm\xe5l")},{block_id:em.newQuestion.blocks.answerHigh,type:"input",element:{type:"plain_text_input",action_id:em.newQuestion.actions.answerHigh,placeholder:ek("Jeg synes at...")},label:ek("\uD83D\uDFE2 Bra svar")},{block_id:em.newQuestion.blocks.answerMid,type:"input",element:{type:"plain_text_input",action_id:em.newQuestion.actions.answerMid,placeholder:ek("Vi er et...")},label:ek("\uD83D\uDFE1 Medium svar")},{block_id:em.newQuestion.blocks.answerLow,type:"input",element:{type:"plain_text_input",action_id:em.newQuestion.actions.answerLow,placeholder:ek("Ting er...")},label:ek("\uD83D\uDD34 D\xe5rlig svar :(")},{type:"input",label:ek("Sp\xf8rsm\xe5lskategori (brukes til statistikk)"),block_id:em.newQuestion.blocks.category,element:{type:"static_select",placeholder:ek("Velg kategori"),options:Object.values(el.c).map(e=>({text:ek(e),value:e})),initial_option:{text:ek(el.c.SPEED),value:el.c.SPEED},action_id:em.newQuestion.actions.category}},{type:"actions",block_id:em.skipAddQuestion.block,elements:[{type:"button",text:ek("Avbryt nytt sp\xf8rsm\xe5l"),value:"regret-add-question",action_id:em.skipAddQuestion.action}]}]),...W(!t,()=>({type:"actions",block_id:em.addQuestion.block,elements:[{type:"button",text:ek("Legg til sp\xf8rsm\xe5l"),value:"add-question",action_id:em.addQuestion.action}]}))]}(e,t)],submit:{type:"plain_text",text:"Lagre"},close:{type:"plain_text",text:"Lukk"}}}function ev(e){return+e.split(":")[0]}async function ew(e,t){try{let a=await t.conversations.info({channel:e});if(a.ok&&a.channel&&!a.channel.is_member)return"not_in_public";if(!a.ok)return console.info(`Unable to get channel info, integration not in channel, or is a DM?: ${a.error??"No error"}`),"not_in_private";return!0}catch(e){return console.error(Error("Couldn't get channel info",{cause:e})),"unknown"}}var ey=a(34787);let eg=r.logger.child({x_context:"slack-bot",x_isSlack:!0}),ef={debug:e=>eg.debug(e),info:e=>eg.info(e),warn:e=>eg.warn(e),error:e=>eg.error(e),getLevel:()=>eg.level,setLevel:()=>void 0,setName:()=>void 0},e_=(0,i.s)("bolt",()=>new ey.App({socketMode:!0,token:process.env.SLACK_BOT_TOKEN,signingSecret:process.env.SLACK_SIGNING_SECRET,appToken:process.env.SLACK_APP_TOKEN,logger:ef})),eb=[function(e){e.command(/(.*)/,async({command:e,ack:t,client:a,respond:n})=>{if(console.info("User used /helsesjekk command"),e.text.trim().startsWith("assign")){let a=e.text.replace("assign","").trim();if(0===a.length){await t(),await n({text:"Du m\xe5 skrive inn en ad-gruppe etter kommandoen. :meow_sob:"});return}console.info(`User wants to connect ${e.channel_id} to ${a}`),await t(),await (0,d.updateTeamGroupAssociation)(e.channel_id,a),await n({text:`Denne kanalen har blitt koblet til ad-gruppe "${a}"`});return}let i=await ew(e.channel_id,a);if(!0!==i){console.warn(`Someone used /helsesjekk in a DM or a channel where it hasn't been added. Type: ${i} Channel ID: ${e.channel_id}`),await t(),await n({text:"Ser ut som du pr\xf8ver \xe5 ta i bruk helsesjekk i en kanal hvor jeg ikke er lagt til. :meow-shocked: Kan du legge meg til som en integrasjon f\xf8rst? :smile:"});return}await t();let o=await (0,d.getTeam)(e.channel_id)??await (0,d.createTeam)(e.channel_id,"[Ditt Team]");await a.views.open({trigger_id:e.trigger_id,view:eh(o)})}),e.event("app_mention",async({event:e,say:t})=>{console.info("User mentioned the bot in production")})},function(e){(0,o.schedule)("*/5 * * * *",()=>ei(e))},function(e){e.event("channel_archive",async({event:e})=>{console.info(`Deactivating team ${e.channel} because public channel was archived`),await (0,d.deactivateTeam)(e.channel)}),e.event("group_archive",async({event:e})=>{console.info(`Deactivating team ${e.channel} because private channel was archived`),await (0,d.deactivateTeam)(e.channel)}),e.event("channel_left",async({event:e})=>{console.info(`Deactivating team ${e.channel} because bot was removed from channel.`),await (0,d.deactivateTeam)(e.channel)}),e.event("group_left",async({event:e})=>{console.info(`Deactivating team ${e.channel} because bot was removed from channel.`),await (0,d.deactivateTeam)(e.channel)})},function(e){e.view(em.modalSubmit,async({ack:e,view:t,client:a,body:n})=>{console.info("User submitted settings modal");let i=t.state.values,o=t.private_metadata,r={name:i[em.teamName.block][em.teamName.action].value,active:i[em.active.block][em.active.action].selected_options.length>0,postDay:+(i[em.postDay.block][em.postDay.action].selected_option.value??4),postHour:ev(i[em.postHour.block][em.postHour.action].selected_time),revealDay:+(i[em.revealDay.block][em.revealDay.action].selected_option.value??0),revealHour:ev(i[em.revealHour.block][em.revealHour.action].selected_time)},s=i[em.newQuestion.blocks.question]?{question:i[em.newQuestion.blocks.question][em.newQuestion.actions.question].value,high:i[em.newQuestion.blocks.answerHigh][em.newQuestion.actions.answerHigh].value,mid:i[em.newQuestion.blocks.answerMid][em.newQuestion.actions.answerMid].value,low:i[em.newQuestion.blocks.answerLow][em.newQuestion.actions.answerLow].value,category:i[em.newQuestion.blocks.category][em.newQuestion.actions.category].selected_option.value}:null,l=await (0,d.updateTeam)(o,r,s);if(await e(),l.active){let{postDate:e}=T({team:l,frequency:l.frequency,weekSkew:l.weekSkew});await a.chat.postEphemeral({user:n.user.id,channel:o,text:`Lagret innstillingene for ${l.name}!

Jeg vil legge ut helsesjekken p\xe5 ${(0,p.hR)(l.postDay)} kl. ${l.postHour}:00 ${S(e)} og vise metrikkene p\xe5f\xf8lgende ${(0,p.hR)(l.revealDay)} kl. ${l.revealHour}:00`})}else await a.chat.postEphemeral({user:n.user.id,channel:o,text:`Lagret innstillingene for ${l.name}! Jeg er n\xe5 deaktivert og vil ikke lenger poste helsesjekker.`});await z(l,a)}),e.action({block_id:em.addQuestion.block,action_id:em.addQuestion.action},async({ack:e,body:t,client:a})=>{if("block_actions"!==t.type||!t.view){await e();return}let n=await (0,d.getTeam)(t.view.private_metadata);if(null==n)throw Error("Unable to update view for team that does not exist");await e(),await a.views.update({view_id:t.view.id,hash:t.view.hash,view:eh(n,!0)})}),e.action({block_id:em.skipAddQuestion.block,action_id:em.skipAddQuestion.action},async({ack:e,body:t,client:a})=>{if("block_actions"!==t.type||!t.view){await e();return}let n=await (0,d.getTeam)(t.view.private_metadata);if(null==n)throw Error("Unable to update view for team that does not exist");await e(),await a.views.update({view_id:t.view.id,hash:t.view.hash,view:eh(n,!1)})}),e.action(em.deleteQuestion.action,async({ack:e,body:t,client:a})=>{if("block_actions"!==t.type||!t.view){await e();return}let n=t.view.private_metadata,i=t.actions.at(0)?.block_id;if(!i)throw Error("Unable to find question id");await e();let o=await (0,d.deleteQuestionFromTeam)(n,i);await a.views.update({view_id:t.view.id,hash:t.view.hash,view:eh(o,!1)})})},function(e){e.action(P.FillButtonClicked,async({ack:e,action:t,body:a,client:n})=>{if(console.info("User clicked fill out helsesjekk button, opening modal"),"button"!==t.type||"block_actions"!==a.type)throw Error(`${P.FillButtonClicked} id used for something else than a button: ${t.type}, ${a.type}`);await e();let i=a.user.id,o=a.channel?.id??"",r=await (0,d.getTeam)(o),s=await (0,d.getAsked)(o,a.message?.ts??"");if(null==r||null==s){console.error(`Someone tried to fill out a healthcheck, but we couldn't find the team or asked, team: ${o}, asked-ts: ${a.message?.ts??""}`),await n.chat.postEphemeral({channel:o,text:":tennepaadass2: Det ser ut som du svarer p\xe5 et sp\xf8rsm\xe5l som aldri er spurt. :meow-shocked: Kan du ta kontakt i <#C04LG229SE7>? :smile:",user:i});return}let l=await (0,d.getAnswer)(i,s.id),c=l?.answers?(0,L.fe)(l.answers):null;await n.views.open({trigger_id:a.trigger_id,view:{type:"modal",callback_id:ec.modalSubmit,title:{type:"plain_text",text:`Svar p\xe5 helsesjekk`,emoji:!0},submit:{type:"plain_text",text:"Send inn",emoji:!0},close:{type:"plain_text",text:"Avbryt",emoji:!0},private_metadata:r.id,blocks:function(e,t){let a=(0,M.a)(e,e=>e.type),n=[...C(a.TEAM_HEALTH,e=>[O((0,K.L)(el.c.TEAM_HEALTH)),...e.map(e=>eu(e,t))]),...C(a.SPEED,e=>[O((0,K.L)(el.c.SPEED)),...e.map(e=>eu(e,t))]),...C(a.TECH,e=>[O((0,K.L)(el.c.TECH)),...e.map(e=>eu(e,t))]),...C(a.OTHER,e=>[O((0,K.L)(el.c.OTHER)),...e.map(e=>eu(e,t))])],i=[...n.slice(0,-1),...n.slice(-1).map(e=>({...e,block_id:"feedback-block"}))];return[...null!=t?[U(`:information_source: Du har allerede svart p\xe5 denne helsesjekken. Men du kan gjerne oppdatere svarene dine.`)]:[],{type:"section",text:{type:"plain_text",text:"Hvordan st\xe5r det til?",emoji:!0}},...i,{type:"context",elements:[{type:"plain_text",text:"Hva du svarer deles ikke med noen. Det brukes kun til \xe5 lage helsemetrikker for teamet.",emoji:!0}]}]}((0,L.Pg)(s.questions),c)}})}),e.view(ec.modalSubmit,async({ack:e,view:t,body:a,client:n})=>{console.info("User submitted healthcheck modal");let i=I.a(t.state.values,eo.a(),er.a(R.a("radio-button-group-answer")),es.a(e=>null!=e.selected_option),er.a(e=>e.selected_option?.value??""),er.a(ep),es.a(([,e])=>"not-applicable"!==e)),o=a.user.id,r=t.private_metadata??"unknown",s=await (0,d.getTeam)(r),l=await (0,d.getActiveAsk)(r);if(null==s||null==l)return await n.chat.postEphemeral({channel:r,text:":tennepaadass2: Det ser ut som du svarer p\xe5 et sp\xf8rsm\xe5l som aldri er spurt. :meow-shocked: Kan du ta kontakt i <#C04LG229SE7>? :smile:",user:o}),e({response_action:"errors",errors:{"feedback-block":"Det ser ut som du svarer p\xe5 et sp\xf8rsm\xe5l som aldri er spurt. Kan du ta kontakt i #helsesjek-bot?"}});await (0,d.answerQuestions)(l,i,a.user.id),await e(),await z(s,n)})}];async function ex(){console.info("Setting up bolt app...");let e=e_();return eb.forEach(t=>t(e)),await e.start(),console.info("Started bolt app in socket mode"),e}let e$=(0,i.c)("bot-status",()=>({started:!1,ready:!1})),eD=(0,i.s)("bot",()=>ex())},43194:(e,t,a)=>{a.d(t,{L:()=>i});var n=a(35379);function i(e){switch(e){case n.c.TEAM_HEALTH:return"Teamhelse";case n.c.SPEED:return"Fart & flyt";case n.c.TECH:return"Teknisk";case n.c.OTHER:return"Annet"}}},76014:(e,t,a)=>{a.d(t,{S:()=>n});function n(e){return e<2.6?"\uD83D\uDD34":e<4?"\uD83D\uDFE1":"\uD83D\uDFE2"}},26251:(e,t,a)=>{a.d(t,{O:()=>n});function n(e){if("string"==typeof e)throw Error(e);throw e}}};